<!doctype html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Automotora Pro | Inicio</title>
    <link rel="icon" type="image/x-icon" href="/favicon.ico?v=2" />
    <!-- Bootstrap CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="style.css" />
    <!-- Flatpickr CSS -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css"
    />
    <!-- Tema Dark (Opcional, se ve mejor) -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/flatpickr/dist/themes/material_blue.css"
    />
  </head>
  <body>
    <!-- NAVBAR CENTRADA -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark py-3">
      <div class="container">
        <a class="navbar-brand fw-bold" href="index.html">üöó Automotora</a>
        <button
          class="navbar-toggler"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navbarNav"
        >
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
          <ul class="navbar-nav mx-auto mb-2 mb-lg-0">
            <li class="nav-item">
              <a class="nav-link active" href="index.html">Veh√≠culos</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="about.html">Sobre el Proyecto</a>
            </li>
          </ul>

          <!-- Bot√≥n Dark Mode (A la derecha usando ms-lg-auto) -->
          <div class="d-flex ms-lg-auto align-items-center">
            <button id="theme-toggle" title="Cambiar Tema">
              <!-- El icono se inyectar√° por JS -->
              üåô
            </button>
          </div>
        </div>
      </div>
    </nav>

    <!-- HERO SECTION -->
    <div class="bg-primary text-white text-center py-5 mb-5">
      <div class="container">
        <h1 class="display-4 fw-bold">Encuentra tu pr√≥ximo auto</h1>
        <p class="lead">
          Agenda una visita presencial y recibe confirmaci√≥n instant√°nea por
          WhatsApp.
        </p>
      </div>
    </div>

    <!-- FILTRO DE B√öSQUEDA MEJORADO -->
    <div class="container mt-n5 mb-5" style="position: relative; z-index: 10">
      <!-- Agregamos la clase 'filter-card' -->
      <div class="card filter-card p-4">
        <h5 class="mb-4 text-primary fw-bold">
          <span style="margin-right: 8px">üîç</span>Encuentra tu auto ideal
        </h5>

        <div class="row g-4 align-items-end">
          <!-- Filtro Marca -->
          <div class="col-md-3">
            <label class="filter-label fw-bold">Marca</label>
            <!-- Agregamos clase 'filter-select' -->
            <select id="filter-brand" class="form-select filter-select">
              <option value="all">Todas las marcas</option>
            </select>
          </div>

          <!-- Filtro A√±o -->
          <div class="col-md-3">
            <label class="filter-label fw-bold">A√±o</label>
            <!-- Agregamos clase 'filter-select' -->
            <select id="filter-year" class="form-select filter-select">
              <option value="all">Todos los a√±os</option>
            </select>
          </div>

          <!-- Filtro Precio (Slider) -->
          <div class="col-md-4">
            <label
              class="filter-label fw-bold d-flex justify-content-between align-items-center"
            >
              Presupuesto M√°ximo
              <span class="badge bg-primary rounded-pill fs-6" id="price-value"
                >$90,000</span
              >
            </label>
            <!-- Agregamos clase 'custom-range' y 'form-range' -->
            <input
              type="range"
              class="form-range custom-range"
              id="filter-price"
              min="0"
              max="90000"
              step="1000"
              value="90000"
            />
            <div class="d-flex justify-content-between text-muted small mt-1">
              <span>$0</span>
              <span>$90k</span>
            </div>
          </div>

          <!-- Bot√≥n Limpiar -->
          <div class="col-md-2 d-grid">
            <button
              id="btn-reset"
              class="btn btn-outline-secondary py-2 fw-bold"
              style="border-width: 2px"
            >
              ‚Ü∫ Limpiar
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- LISTADO DE AUTOS -->
    <div class="container mb-5">
      <h2 class="text-center mb-4 text-secondary">Veh√≠culos Disponibles</h2>
      <!-- Aqu√≠ JS inyectar√° las cards de bootstrap -->
      <div id="car-list" class="row row-cols-1 row-cols-md-3 g-4">
        <div class="text-center w-100">Cargando cat√°logo...</div>
      </div>
    </div>

    <!-- MODAL DE BOOTSTRAP (Formulario de Agenda) -->
    <div class="modal fade" id="bookingModal" tabindex="-1" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header bg-primary text-white">
            <h5 class="modal-title">üìÖ Agendar Visita</h5>
            <button
              type="button"
              class="btn-close btn-close-white"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <div class="modal-body">
            <p class="text-muted" id="selected-car-text">
              Auto seleccionado: ...
            </p>

            <form id="booking-form">
              <input type="hidden" id="vehicle_id" name="vehicle_id" />

              <div class="mb-3">
                <label class="form-label">Tu Nombre</label>
                <input
                  type="text"
                  class="form-control"
                  id="name"
                  placeholder="Ej: Juan P√©rez"
                  required
                />
              </div>

              <!-- NUEVO CAMPO EMAIL -->
              <div class="mb-3">
                <label class="form-label">Correo Electr√≥nico</label>
                <input
                  type="email"
                  class="form-control"
                  id="email"
                  placeholder="juan@ejemplo.com"
                  required
                />
              </div>

              <div class="mb-3">
                <label class="form-label"
                  >Tel√©fono (WhatsApp) --> Twilio no disponible por cobro de
                  API</label
                >
                <input
                  type="text"
                  class="form-control"
                  id="phone"
                  placeholder="+56912345678"
                  required
                />
                <div class="form-text">Te enviaremos la confirmaci√≥n aqu√≠.</div>
              </div>

              <!-- SELECCI√ìN DE FECHA -->
              <div class="mb-3">
                <label class="form-label fw-bold">1. Selecciona el D√≠a</label>
                <input
                  type="text"
                  class="form-control bg-white"
                  id="date-picker"
                  placeholder="Toca para abrir calendario..."
                  readonly
                />
                <div class="form-text">S√°bados y Domingos inhabilitados.</div>
              </div>

              <!-- SELECCI√ìN DE HORA (Din√°mica) -->
              <div class="mb-3">
                <label class="form-label fw-bold">2. Horario Disponible</label>
                <select class="form-select" id="time-select" disabled>
                  <option value="" selected>Primero elige un d√≠a ‚òùÔ∏è</option>
                </select>
              </div>

              <div class="d-grid">
                <button type="submit" class="btn btn-success btn-lg">
                  Confirmar Reserva
                </button>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>

    <!-- CHATBOT WIDGET -->
    <div
      id="chat-widget-container"
      style="position: fixed; bottom: 20px; right: 20px; z-index: 1000"
    >
      <!-- Ventana del Chat (Oculta al inicio) -->
      <div
        id="chat-window"
        class="card shadow-lg mb-3"
        style="
          width: 350px;
          display: none;
          border-radius: 15px;
          overflow: hidden;
        "
      >
        <div
          class="card-header bg-primary text-white d-flex justify-content-between align-items-center"
        >
          <span class="fw-bold">ü§ñ Asistente Virtual</span>
          <button
            onclick="toggleChat()"
            class="btn btn-sm btn-close btn-close-white"
          ></button>
        </div>

        <div
          id="chat-messages"
          class="card-body bg-light"
          style="height: 300px; overflow-y: auto; font-size: 0.9rem"
        >
          <!-- Mensaje de bienvenida -->
          <div class="d-flex align-items-start mb-2">
            <div
              class="bg-white p-2 rounded shadow-sm text-dark border"
              style="max-width: 80%"
            >
              Hola üëã Soy la IA de la automotora. Preg√∫ntame sobre precios,
              modelos o qu√© autos tenemos disponibles.
            </div>
          </div>
        </div>

        <div class="card-footer bg-white">
          <div class="input-group">
            <input
              type="text"
              id="chat-input"
              class="form-control border-0"
              placeholder="Escribe tu pregunta..."
              onkeypress="handleEnter(event)"
            />
            <button class="btn btn-primary" onclick="sendMessage()">‚û§</button>
          </div>
        </div>
      </div>

      <!-- Bot√≥n Flotante -->
      <button
        onclick="toggleChat()"
        class="btn btn-primary rounded-circle shadow-lg d-flex align-items-center justify-content-center"
        style="width: 60px; height: 60px; transition: transform 0.2s"
      >
        <span style="font-size: 30px">üí¨</span>
      </button>
    </div>
    <!-- Bootstrap Bundle JS -->
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script src="https://npmcdn.com/flatpickr/dist/l10n/es.js"></script>
    <!-- Espa√±ol -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script type="module" src="app.js"></script>
  </body>
</html>
